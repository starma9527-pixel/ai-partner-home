<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å†…å®¹ç®¡ç†åå° - AIå…ˆé”‹Â·ä¼™ä¼´ä¹‹å®¶</title>
  <style>
    :root {
      --purple: #7c3aed;
      --green: #059669;
      --bg: #f5f6fa;
      --card: #ffffff;
      --text: #1a1a2e;
      --muted: #888;
      --border: #e0e0e8;
      --radius: 10px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;
      background: var(--bg); color: var(--text); line-height: 1.6;
    }
    .admin-header {
      background: linear-gradient(135deg, #7c3aed, #6d28d9);
      color: #fff; padding: 20px 24px;
    }
    .admin-header h1 { font-size: 1.3rem; }
    .admin-header p { font-size: 0.85rem; opacity: 0.8; margin-top: 4px; }
    .admin-tabs {
      display: flex; gap: 4px; padding: 12px 24px; background: var(--card);
      border-bottom: 1px solid var(--border); flex-wrap: wrap;
    }
    .admin-tab {
      padding: 8px 18px; border-radius: 8px; border: 1px solid var(--border);
      background: transparent; color: var(--text); cursor: pointer;
      font-size: 0.85rem; transition: all 0.2s;
    }
    .admin-tab:hover { border-color: var(--purple); color: var(--purple); }
    .admin-tab.active { background: var(--purple); color: #fff; border-color: var(--purple); }
    .admin-body { max-width: 900px; margin: 0 auto; padding: 20px; }
    .admin-panel { display: none; }
    .admin-panel.active { display: block; }
    .card {
      background: var(--card); border-radius: var(--radius);
      border: 1px solid var(--border); padding: 24px; margin-bottom: 20px;
    }
    .card h3 { font-size: 1rem; margin-bottom: 16px; color: var(--purple); }
    .field { margin-bottom: 14px; }
    .field label { display: block; font-size: 0.82rem; font-weight: 600; color: var(--muted); margin-bottom: 4px; }
    .field input, .field textarea, .field select {
      width: 100%; padding: 10px 14px; border: 1px solid var(--border);
      border-radius: 8px; font-size: 0.9rem; color: var(--text);
      background: var(--bg); transition: border-color 0.2s;
    }
    .field input:focus, .field textarea:focus { border-color: var(--purple); outline: none; }
    .field textarea { min-height: 80px; resize: vertical; }
    .item-row {
      background: var(--bg); border: 1px solid var(--border); border-radius: 8px;
      padding: 16px; margin-bottom: 10px; position: relative;
    }
    .item-row .field { margin-bottom: 10px; }
    .item-row .field:last-child { margin-bottom: 0; }
    .btn-remove {
      position: absolute; top: 8px; right: 8px;
      background: #fee2e2; color: #dc2626; border: none; border-radius: 6px;
      padding: 4px 10px; font-size: 0.75rem; cursor: pointer;
    }
    .btn-remove:hover { background: #fecaca; }
    .btn-add {
      background: rgba(124,58,237,0.08); color: var(--purple); border: 1px dashed var(--purple);
      border-radius: 8px; padding: 10px; width: 100%; cursor: pointer;
      font-size: 0.85rem; margin-top: 8px; transition: background 0.2s;
    }
    .btn-add:hover { background: rgba(124,58,237,0.15); }
    .actions {
      position: sticky; bottom: 0; background: var(--card); border-top: 1px solid var(--border);
      padding: 16px 24px; display: flex; gap: 12px; justify-content: center;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }
    .btn-save {
      background: linear-gradient(135deg, #10b981, #059669);
      color: #fff; border: none; border-radius: 8px;
      padding: 12px 36px; font-size: 1rem; font-weight: 600; cursor: pointer;
    }
    .btn-save:hover { opacity: 0.9; }
    .btn-preview {
      background: var(--bg); color: var(--text); border: 1px solid var(--border);
      border-radius: 8px; padding: 12px 36px; font-size: 1rem; cursor: pointer;
    }
    .btn-preview:hover { border-color: var(--purple); }
    .toast {
      position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
      background: var(--green); color: #fff; padding: 10px 28px; border-radius: 20px;
      font-size: 0.85rem; font-weight: 600; opacity: 0; transition: opacity 0.3s; z-index: 999;
    }
    .toast.show { opacity: 1; }
    .inline-fields { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 600px) { .inline-fields { grid-template-columns: 1fr; } }
    .help-text { font-size: 0.78rem; color: var(--muted); margin-top: 16px; padding: 12px; background: #fffbeb; border-radius: 8px; border: 1px solid #fde68a; }
  </style>
</head>
<body>

<div class="admin-header">
  <h1>ğŸ“‹ å†…å®¹ç®¡ç†åå°</h1>
  <p>ä¿®æ”¹ä¸‹æ–¹å†…å®¹ â†’ ç‚¹å‡»ã€Œä¿å­˜å¹¶ä¸‹è½½ã€â†’ æ›¿æ¢é¡¹ç›®ä¸­çš„ app.js â†’ é‡æ–°æ‹–æ‹½åˆ° Netlify</p>
</div>

<div class="admin-tabs" id="adminTabs">
  <button class="admin-tab active" data-panel="p-home">ğŸ  é¦–é¡µ</button>
  <button class="admin-tab" data-panel="p-weapons">ğŸ§° æ‰“å•å…µå™¨</button>
  <button class="admin-tab" data-panel="p-maas">ğŸš€ èµ¢æˆ˜MaaS</button>
  <button class="admin-tab" data-panel="p-guide">ğŸ¯ æ‹œè®¿æ•™ç»ƒ</button>
  <button class="admin-tab" data-panel="p-rank">ğŸ† é¾™è™æ¦œ</button>
  <button class="admin-tab" data-panel="p-feedback">ğŸ’¬ å›éŸ³å£</button>
</div>

<div class="admin-body">

  <!-- HOME -->
  <div class="admin-panel active" id="p-home">
    <div class="card">
      <h3>ğŸ”¥ çƒ­æœå…³é”®è¯</h3>
      <div class="field">
        <label>ç”¨é€—å·åˆ†éš”å¤šä¸ªå…³é”®è¯</label>
        <input type="text" id="f-hotSearch" placeholder="åŒ»ç–—è¡Œä¸šæŠ¥ä»·, æœ€æ–°AIå¤§å•æ¡ˆä¾‹, é€šä¹‰åƒé—®æ¥å…¥æŒ‡å—" />
      </div>
    </div>
    <div class="card">
      <h3>ğŸ“¢ å…¬å‘Š</h3>
      <div id="list-announcements"></div>
      <button class="btn-add" onclick="addAnnouncement()">+ æ·»åŠ å…¬å‘Š</button>
    </div>
  </div>

  <!-- WEAPONS -->
  <div class="admin-panel" id="p-weapons">
    <div class="card">
      <h3>ğŸ“‹ ä¸šåŠ¡è§„åˆ™æ–‡æ¡£</h3>
      <div id="list-rules"></div>
      <button class="btn-add" onclick="addRule()">+ æ·»åŠ æ–‡æ¡£</button>
    </div>
    <div class="card">
      <h3>ğŸ”§ å¸¸ç”¨å·¥å…·</h3>
      <div id="list-tools"></div>
      <button class="btn-add" onclick="addTool()">+ æ·»åŠ å·¥å…·</button>
    </div>
    <div class="card">
      <h3>ğŸ“– ç”Ÿæ€çŸ¥è¯†åº“</h3>
      <div id="list-knowledge"></div>
      <button class="btn-add" onclick="addKnowledge()">+ æ·»åŠ èµ„æ–™</button>
      <div class="field" style="margin-top:14px;">
        <label>é’‰é’‰çŸ¥è¯†åº“å®Œæ•´é“¾æ¥</label>
        <input type="text" id="f-kbLink" placeholder="https://alidocs.dingtalk.com/..." />
      </div>
    </div>
    <div class="card">
      <h3>ğŸ¬ å‘¨äº”ä¸Šå¹²è´§ï¼šé’‰é’‰ç›´æ’­åŸ¹è®­</h3>
      <div id="list-trainings"></div>
      <button class="btn-add" onclick="addTraining()">+ æ·»åŠ åŸ¹è®­</button>
      <div class="field" style="margin-top:14px;">
        <label>"æŸ¥çœ‹æ›´å¤šåŸ¹è®­å†…å®¹"é“¾æ¥</label>
        <input type="text" id="f-moreLiveLink" placeholder="https://..." />
      </div>
    </div>
  </div>

  <!-- MAAS -->
  <div class="admin-panel" id="p-maas">
    <div class="card">
      <h3>ğŸš€ èµ¢æˆ˜MaaS - èµ›é“ç®¡ç†</h3>
      <div id="list-tracks"></div>
      <button class="btn-add" onclick="addTrack()">+ æ·»åŠ èµ›é“</button>
    </div>
    <div class="help-text">
      ğŸ’¡ æ¯ä¸ªèµ›é“å¯é…ç½®ï¼šå›¾æ ‡ã€åç§°ã€æè¿°ã€æ ¸å¿ƒåœºæ™¯ï¼ˆå¤šä¸ªï¼‰ã€æ¨èäº§å“ï¼ˆå¤šä¸ªï¼‰ã€æ¡ˆä¾‹è¯´æ˜ã€è¯¦æƒ…é“¾æ¥
    </div>
  </div>

  <!-- GUIDE -->
  <div class="admin-panel" id="p-guide">
    <div class="help-text">
      ğŸ’¡ ã€ŒğŸ” ç”„é€‰å®¢æˆ·ï¼šAIæ½œåŠ›è¯„ä¼°ã€å’Œã€ŒğŸ¯ æ‹œè®¿å®¢æˆ·ï¼šç”Ÿæˆæ‹œè®¿è®¡åˆ’ã€åŠŸèƒ½ç”± AI å®æ—¶ç”Ÿæˆï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®æ•°æ®ã€‚<br><br>
      ç”¨æˆ·åœ¨å‰å°é¡µé¢è¾“å…¥å®¢æˆ·ä¿¡æ¯åï¼ŒAI ä¼šè‡ªåŠ¨è°ƒç”¨é€šä¹‰åƒé—®æ¨¡å‹ç”Ÿæˆåˆ†ææŠ¥å‘Šå’Œæ‹œè®¿è®¡åˆ’ã€‚
    </div>
  </div>

  <!-- RANK -->
  <div class="admin-panel" id="p-rank">
    <div class="card">
      <h3>ğŸ¤– Tokenè°ƒç”¨æ’è¡Œ</h3>
      <div id="list-tokenRank"></div>
      <button class="btn-add" onclick="addRankItem('tokenRank')">+ æ·»åŠ </button>
    </div>
    <div class="card">
      <h3>ğŸ“ æ¡ˆä¾‹è´¡çŒ®æ’è¡Œ</h3>
      <div id="list-caseRank"></div>
      <button class="btn-add" onclick="addRankItem('caseRank')">+ æ·»åŠ </button>
    </div>
    <div class="card">
      <h3>ğŸ“– å­¦ä¹ æ—¶é•¿æ’è¡Œ</h3>
      <div id="list-studyRank"></div>
      <button class="btn-add" onclick="addRankItem('studyRank')">+ æ·»åŠ </button>
    </div>
    <div class="card">
      <h3>ğŸ“ æŒè¯ç‡æ’è¡Œ</h3>
      <div id="list-certRank"></div>
      <button class="btn-add" onclick="addRankItem('certRank')">+ æ·»åŠ </button>
    </div>
    <div class="card">
      <h3>âš”ï¸ é¡¹ç›®æˆ˜æŠ¥</h3>
      <div id="list-battles"></div>
      <button class="btn-add" onclick="addBattle()">+ æ·»åŠ æˆ˜æŠ¥</button>
    </div>
  </div>

  <!-- FEEDBACK -->
  <div class="admin-panel" id="p-feedback">
    <div class="card">
      <h3>ğŸ“¨ ç²¾é€‰ç•™è¨€</h3>
      <div id="list-messages"></div>
      <button class="btn-add" onclick="addMessage()">+ æ·»åŠ ç•™è¨€</button>
    </div>
  </div>

</div>

<div class="actions">
  <button class="btn-preview" onclick="previewLocal()">ğŸ‘ æœ¬åœ°é¢„è§ˆ</button>
  <button class="btn-save" onclick="saveAndDownload()">ğŸ’¾ ä¿å­˜å¹¶ä¸‹è½½ app.js</button>
</div>

<div class="toast" id="adminToast"></div>

<script>
// ===== Load existing data from app.js =====
// We embed the current SITE_DATA here so the admin can edit it
let editData = {};

// Try to load from the main app's SITE_DATA
function loadCurrentData() {
  // Load the app.js file to extract SITE_DATA
  const script = document.createElement('script');
  script.src = 'js/app.js';
  script.onload = () => {
    if (typeof SITE_DATA !== 'undefined') {
      editData = JSON.parse(JSON.stringify(SITE_DATA));
    }
    populateForms();
  };
  script.onerror = () => {
    editData = getDefaultData();
    populateForms();
  };
  document.head.appendChild(script);
}

function getDefaultData() {
  return {
    site: { name: "AIå…ˆé”‹Â·ä¼™ä¼´ä¹‹å®¶", slogan: "è¥¿éƒ¨å¤§åŒºä¼™ä¼´èµ‹èƒ½å¹³å°", adminEmail: "admin@example.com" },
    hotSearch: [],
    announcements: [],
    quickLinks: [
      { icon: "ğŸ§°", title: "æ‰“å•å…µå™¨", desc: "ä¸šåŠ¡è§„åˆ™Â·å¸¸ç”¨å·¥å…·Â·ç”Ÿæ€çŸ¥è¯†åº“", tab: "weapons" },
      { icon: "ğŸš€", title: "èµ¢æˆ˜MaaS", desc: "è´¢ç¨Â·AIçŸ­å‰§Â·æ™ºèƒ½è¯­éŸ³èµ›é“", tab: "maas" },
      { icon: "ğŸ¯", title: "æ‹œè®¿æ•™ç»ƒ", desc: "ç”„é€‰å®¢æˆ·Â·æ‹œè®¿è®¡åˆ’Â·AIåŠ©æ‰‹", tab: "guide" },
      { icon: "ğŸ†", title: "é¾™è™æ¦œ", desc: "Tokenæ’è¡ŒÂ·æ¡ˆä¾‹è´¡çŒ®Â·å­¦ä¹ æ—¶é•¿", tab: "rank" },
      { icon: "ğŸ’¬", title: "å›éŸ³å£", desc: "ç•™è¨€åé¦ˆÂ·å»ºè®®åæ§½Â·éœ€æ±‚æ”¶é›†", tab: "feedback" }
    ],
    weapons: { rules: [], tools: [], knowledge: [], knowledgeBaseLink: "", liveTrainings: [], moreLiveLink: "#" },
    guide: {},
    maas: { tracks: [] },
    rank: { tokenRank: [], caseRank: [], studyRank: [], certRank: [], battleReports: [] },
    feedback: { messages: [] }
  };
}

// ===== Tab Switching =====
document.getElementById('adminTabs').addEventListener('click', (e) => {
  const btn = e.target.closest('.admin-tab');
  if (!btn) return;
  document.querySelectorAll('.admin-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.admin-panel').forEach(p => p.classList.remove('active'));
  document.getElementById(btn.dataset.panel).classList.add('active');
});

// ===== Populate Forms =====
function populateForms() {
  // Hot search
  document.getElementById('f-hotSearch').value = (editData.hotSearch || []).join(', ');

  // Announcements
  (editData.announcements || []).forEach(a => addAnnouncement(a));

  // Weapons
  (editData.weapons?.rules || []).forEach(r => addRule(r));
  (editData.weapons?.tools || []).forEach(t => addTool(t));
  (editData.weapons?.knowledge || []).forEach(k => addKnowledge(k));
  document.getElementById('f-kbLink').value = editData.weapons?.knowledgeBaseLink || '';

  // Guide (liveTrainings is actually in weapons)
  (editData.weapons?.liveTrainings || []).forEach(t => addTraining(t));
  document.getElementById('f-moreLiveLink').value = editData.weapons?.moreLiveLink || '';

  // MaaS
  (editData.maas?.tracks || []).forEach(t => addTrack(t));

  // Rank
  (editData.rank?.tokenRank || []).forEach(r => addRankItem('tokenRank', r));
  (editData.rank?.caseRank || []).forEach(r => addRankItem('caseRank', r));
  (editData.rank?.studyRank || []).forEach(r => addRankItem('studyRank', r));
  (editData.rank?.certRank || []).forEach(r => addRankItem('certRank', r));
  (editData.rank?.battleReports || []).forEach(b => addBattle(b));

  // Feedback
  (editData.feedback?.messages || []).forEach(m => addMessage(m));
}

// ===== Add Item Functions =====
function createItemRow(container, fields, data) {
  const div = document.createElement('div');
  div.className = 'item-row';
  let html = '<button class="btn-remove" onclick="this.parentElement.remove()">åˆ é™¤</button>';
  fields.forEach(f => {
    const val = data ? (data[f.key] || '') : '';
    if (f.type === 'textarea') {
      html += `<div class="field"><label>${f.label}</label><textarea data-key="${f.key}" placeholder="${f.placeholder || ''}">${val}</textarea></div>`;
    } else {
      html += `<div class="field"><label>${f.label}</label><input type="text" data-key="${f.key}" value="${val}" placeholder="${f.placeholder || ''}" /></div>`;
    }
  });
  div.innerHTML = html;
  document.getElementById(container).appendChild(div);
}

function addAnnouncement(data) {
  createItemRow('list-announcements', [
    { key: 'text', label: 'å…¬å‘Šå†…å®¹', placeholder: '2025å¹´Q1ä¼™ä¼´æ¿€åŠ±æ”¿ç­–å·²å‘å¸ƒ' },
    { key: 'link', label: 'è·³è½¬é“¾æ¥ï¼ˆé€‰å¡«ï¼‰', placeholder: 'https://...' },
    { key: 'date', label: 'æ—¥æœŸ', placeholder: '2025-03-01' }
  ], data);
}

function addRule(data) {
  createItemRow('list-rules', [
    { key: 'title', label: 'æ–‡æ¡£åç§°', placeholder: 'ä¼™ä¼´è¿”ä½£æ”¿ç­– 2025ç‰ˆ' },
    { key: 'size', label: 'æ–‡ä»¶å¤§å°', placeholder: '2.3MB' },
    { key: 'date', label: 'æ—¥æœŸ', placeholder: '2025-02-20' },
    { key: 'link', label: 'ä¸‹è½½é“¾æ¥', placeholder: 'https://...' }
  ], data);
}

function addTool(data) {
  createItemRow('list-tools', [
    { key: 'title', label: 'å·¥å…·åç§°', placeholder: 'æŠ¥ä»·è®¡ç®—å™¨' },
    { key: 'desc', label: 'å·¥å…·æè¿°', placeholder: 'å¿«é€Ÿç”Ÿæˆå®¢æˆ·æŠ¥ä»·å•' },
    { key: 'icon', label: 'å›¾æ ‡ï¼ˆemojiï¼‰', placeholder: 'ğŸ§®' },
    { key: 'link', label: 'é“¾æ¥', placeholder: 'https://...' }
  ], data);
}

function addKnowledge(data) {
  createItemRow('list-knowledge', [
    { key: 'title', label: 'èµ„æ–™åç§°', placeholder: 'åŒ»ç–—è¡Œä¸šäº‘+AIè§£å†³æ–¹æ¡ˆ' },
    { key: 'type', label: 'ç±»å‹ï¼ˆPDF æˆ– VIDEOï¼‰', placeholder: 'PDF' },
    { key: 'size', label: 'å¤§å°ï¼ˆPDFå¡«å¤§å°ï¼Œè§†é¢‘å¡«æ—¶é•¿ï¼‰', placeholder: '5.2MB æˆ– 12:30' },
    { key: 'date', label: 'æ—¥æœŸ', placeholder: '2025-02-18' },
    { key: 'link', label: 'é“¾æ¥', placeholder: 'https://...' }
  ], data);
}

function addTraining(data) {
  createItemRow('list-trainings', [
    { key: 'title', label: 'åŸ¹è®­ä¸»é¢˜', placeholder: 'å¤§æ¨¡å‹åœ¨æ”¿åŠ¡åœºæ™¯çš„è½åœ°å®è·µ' },
    { key: 'date', label: 'ç›´æ’­æ—¶é—´', placeholder: '2025-03-07 14:00' },
    { key: 'speaker', label: 'è®²å¸ˆ', placeholder: 'å¼ ä¸‰' },
    { key: 'link', label: 'ç›´æ’­é“¾æ¥', placeholder: 'https://...' }
  ], data);
}

function addRankItem(type, data) {
  const container = 'list-' + type;
  const div = document.createElement('div');
  div.className = 'item-row';
  const rank = data ? data.rank : '';
  const name = data ? data.name : '';
  const score = data ? data.score : '';
  div.innerHTML = `
    <button class="btn-remove" onclick="this.parentElement.remove()">åˆ é™¤</button>
    <div class="inline-fields">
      <div class="field"><label>æ’å</label><input type="text" data-key="rank" value="${rank}" placeholder="1" /></div>
      <div class="field"><label>å…¬å¸å</label><input type="text" data-key="name" value="${name}" placeholder="é”æ™ºç§‘æŠ€" /></div>
    </div>
    <div class="field"><label>åˆ†æ•°/æ•°å€¼</label><input type="text" data-key="score" value="${score}" placeholder="128000 æˆ– 92%" /></div>
  `;
  document.getElementById(container).appendChild(div);
}

function addBattle(data) {
  createItemRow('list-battles', [
    { key: 'title', label: 'é¡¹ç›®æè¿°', placeholder: 'é”æ™ºç§‘æŠ€ç­¾çº¦XXåŒ»é™¢æ™ºæ…§åŒ»ç–—é¡¹ç›®' },
    { key: 'amount', label: 'é‡‘é¢', placeholder: '230ä¸‡' },
    { key: 'date', label: 'æ—¥æœŸ', placeholder: '2025-02-28' }
  ], data);
}

function addTrack(data) {
  const container = document.getElementById('list-tracks');
  const div = document.createElement('div');
  div.className = 'item-row';
  const id = data ? data.id : 'track' + Date.now();
  const icon = data ? data.icon : '';
  const name = data ? data.name : '';
  const desc = data ? data.desc : '';
  const scenarios = data ? (data.scenarios || []).join('\n') : '';
  const products = data ? (data.products || []).join(', ') : '';
  const cases = data ? data.cases : '';
  const link = data ? data.link : '';
  div.innerHTML = `
    <button class="btn-remove" onclick="this.parentElement.remove()">åˆ é™¤</button>
    <div class="inline-fields">
      <div class="field"><label>èµ›é“ID</label><input type="text" data-key="id" value="${id}" placeholder="tax" /></div>
      <div class="field"><label>å›¾æ ‡ï¼ˆemojiï¼‰</label><input type="text" data-key="icon" value="${icon}" placeholder="ğŸ’°" /></div>
    </div>
    <div class="field"><label>èµ›é“åç§°</label><input type="text" data-key="name" value="${name}" placeholder="èµ›é“1 Â· è´¢ç¨" /></div>
    <div class="field"><label>èµ›é“æè¿°</label><textarea data-key="desc" placeholder="é¢å‘è´¢ç¨è¡Œä¸šçš„MaaSè§£å†³æ–¹æ¡ˆ...">${desc}</textarea></div>
    <div class="field"><label>æ ¸å¿ƒåœºæ™¯ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label><textarea data-key="scenarios" placeholder="æ™ºèƒ½å‘ç¥¨è¯†åˆ«ä¸å½•å…¥\nè´¢åŠ¡æŠ¥è¡¨è‡ªåŠ¨ç”Ÿæˆ\nç¨åŠ¡é£é™©AIé¢„è­¦">${scenarios}</textarea></div>
    <div class="field"><label>æ¨èäº§å“ï¼ˆé€—å·åˆ†éš”ï¼‰</label><input type="text" data-key="products" value="${products}" placeholder="é€šä¹‰åƒé—®API, OCRæ–‡å­—è¯†åˆ«, æ™ºèƒ½å¯¹è¯æœºå™¨äºº" /></div>
    <div class="field"><label>æ¡ˆä¾‹è¯´æ˜</label><input type="text" data-key="cases" value="${cases}" placeholder="å·²æœ‰3å®¶ä¼™ä¼´è½åœ°è´¢ç¨AIé¡¹ç›®ï¼Œç´¯è®¡åˆåŒé¢è¶…200ä¸‡" /></div>
    <div class="field"><label>è¯¦æƒ…é“¾æ¥</label><input type="text" data-key="link" value="${link}" placeholder="https://..." /></div>
  `;
  container.appendChild(div);
}

function addMessage(data) {
  createItemRow('list-messages', [
    { key: 'author', label: 'ä½œè€…', placeholder: 'å¼ ä¼Ÿ Â· é”æ™ºç§‘æŠ€' },
    { key: 'content', label: 'ç•™è¨€å†…å®¹', placeholder: 'å¸Œæœ›èƒ½å¢åŠ æ›´å¤šé‡‘èè¡Œä¸šçš„æ¡ˆä¾‹èµ„æ–™' },
    { key: 'date', label: 'æ—¥æœŸ', placeholder: '2025-02-28' },
    { key: 'likes', label: 'ç‚¹èµæ•°', placeholder: '12' }
  ], data);
}

// ===== Collect Data from Forms =====
function collectData() {
  const data = JSON.parse(JSON.stringify(getDefaultData()));

  // Hot search
  const hs = document.getElementById('f-hotSearch').value.trim();
  data.hotSearch = hs ? hs.split(/[,ï¼Œ]/).map(s => s.trim()).filter(Boolean) : [];

  // Announcements
  data.announcements = collectList('list-announcements', ['text', 'link', 'date']).map((a, i) => ({ id: i + 1, ...a }));

  // Weapons
  data.weapons.rules = collectList('list-rules', ['title', 'size', 'date', 'link']).map(r => ({ ...r, type: 'PDF' }));
  data.weapons.tools = collectList('list-tools', ['title', 'desc', 'icon', 'link']);
  data.weapons.knowledge = collectList('list-knowledge', ['title', 'type', 'size', 'date', 'link']).map(k => {
    const isVideo = (k.type || '').toUpperCase() === 'VIDEO';
    const item = { title: k.title, type: isVideo ? 'VIDEO' : 'PDF', date: k.date, link: k.link };
    if (isVideo) item.duration = k.size; else item.size = k.size;
    return item;
  });
  data.weapons.knowledgeBaseLink = document.getElementById('f-kbLink').value.trim();
  data.weapons.liveTrainings = collectList('list-trainings', ['title', 'date', 'speaker', 'link']).map(t => ({ ...t, cover: '' }));
  data.weapons.moreLiveLink = document.getElementById('f-moreLiveLink').value.trim() || '#';

  // Guide (AI-generated content, no manual data needed)
  data.guide = {};

  // MaaS
  data.maas = { tracks: collectTrackList() };

  // Rank
  data.rank.tokenRank = collectRankList('list-tokenRank');
  data.rank.caseRank = collectRankList('list-caseRank');
  data.rank.studyRank = collectRankList('list-studyRank');
  data.rank.certRank = collectRankList('list-certRank');
  data.rank.battleReports = collectList('list-battles', ['title', 'amount', 'date']);

  // Feedback
  data.feedback.messages = collectList('list-messages', ['author', 'content', 'date', 'likes']).map((m, i) => ({
    id: i + 1, author: m.author, content: m.content, date: m.date, likes: parseInt(m.likes) || 0
  }));

  return data;
}

function collectList(containerId, keys) {
  const rows = document.getElementById(containerId).querySelectorAll('.item-row');
  return Array.from(rows).map(row => {
    const obj = {};
    keys.forEach(key => {
      const el = row.querySelector(`[data-key="${key}"]`);
      obj[key] = el ? el.value.trim() : '';
    });
    return obj;
  });
}

function collectRankList(containerId) {
  const rows = document.getElementById(containerId).querySelectorAll('.item-row');
  return Array.from(rows).map(row => {
    const rank = parseInt(row.querySelector('[data-key="rank"]')?.value) || 0;
    const name = row.querySelector('[data-key="name"]')?.value.trim() || '';
    let score = row.querySelector('[data-key="score"]')?.value.trim() || '';
    // Try to convert to number if it's purely numeric
    const num = Number(score);
    if (!isNaN(num) && score !== '' && !/[%h]/.test(score)) score = num;
    return { rank, name, score };
  });
}

function collectTrackList() {
  const rows = document.getElementById('list-tracks').querySelectorAll('.item-row');
  return Array.from(rows).map(row => {
    const id = row.querySelector('[data-key="id"]')?.value.trim() || '';
    const icon = row.querySelector('[data-key="icon"]')?.value.trim() || '';
    const name = row.querySelector('[data-key="name"]')?.value.trim() || '';
    const desc = row.querySelector('[data-key="desc"]')?.value.trim() || '';
    const scenariosRaw = row.querySelector('[data-key="scenarios"]')?.value.trim() || '';
    const scenarios = scenariosRaw ? scenariosRaw.split('\n').map(s => s.trim()).filter(Boolean) : [];
    const productsRaw = row.querySelector('[data-key="products"]')?.value.trim() || '';
    const products = productsRaw ? productsRaw.split(/[,ï¼Œ]/).map(s => s.trim()).filter(Boolean) : [];
    const cases = row.querySelector('[data-key="cases"]')?.value.trim() || '';
    const link = row.querySelector('[data-key="link"]')?.value.trim() || '#';
    return { id, icon, name, desc, scenarios, products, cases, link };
  });
}

// ===== Generate app.js content =====
function generateAppJS(data) {
  // Read the existing app.js to get the code part (everything after SITE_DATA)
  const jsonStr = JSON.stringify(data, null, 2);
  return `/**
 * AIå…ˆé”‹Â·ä¼™ä¼´ä¹‹å®¶ - Main Application Logic
 * ====================================================
 * ã€æŠ€æœ¯å°ç™½æ›´æ–°æŒ‡å—ã€‘
 *   è¦æ›´æ–°ç½‘ç«™å†…å®¹ï¼Œè¯·æ‰“å¼€ admin.html ç®¡ç†åå°ä¿®æ”¹æ•°æ®ã€‚
 *   æˆ–è€…ç›´æ¥ä¿®æ”¹ä¸‹æ–¹ SITE_DATA å¯¹è±¡ä¸­çš„æ•°æ®ã€‚
 * ====================================================
 */

// ===== ç½‘ç«™æ•°æ®ï¼ˆç›´æ¥ä¿®æ”¹è¿™é‡Œå³å¯æ›´æ–°å†…å®¹ï¼‰ =====
const SITE_DATA = ${jsonStr};

${APP_CODE}`;
}

// Store the code portion of app.js (everything except SITE_DATA)
const APP_CODE = `// ===== Global State =====
let siteData = null;

// ===== Init =====
document.addEventListener('DOMContentLoaded', async () => {
  await loadSiteData();
  initTabs();
  initRankTabs();
  initSceneSelector();
  renderHome();
  renderWeapons();
  renderGuide();
  renderRank();
  renderFeedback();
});

// ===== Load Data =====
async function loadSiteData() {
  try {
    const resp = await fetch('data/site-data.json');
    if (resp.ok) {
      siteData = await resp.json();
      return;
    }
  } catch (e) {}
  siteData = SITE_DATA;
}

// ===== Tab Navigation =====
function initTabs() {
  const nav = document.getElementById('pillNav');
  nav.addEventListener('click', (e) => {
    const btn = e.target.closest('.pill-btn');
    if (!btn) return;
    const tab = btn.dataset.tab;
    nav.querySelectorAll('.pill-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    document.getElementById('tab-' + tab).classList.add('active');
    window.scrollTo({ top: document.querySelector('.search-bar-area').offsetTop - 60, behavior: 'smooth' });
  });
}

// ===== Rank Sub-tabs =====
function initRankTabs() {
  const tabs = document.getElementById('rankTabs');
  if (!tabs) return;
  tabs.addEventListener('click', (e) => {
    const btn = e.target.closest('.rank-tab');
    if (!btn) return;
    const rank = btn.dataset.rank;
    tabs.querySelectorAll('.rank-tab').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.rank-panel').forEach(p => p.classList.remove('active'));
    document.getElementById('rank-' + rank).classList.add('active');
  });
}

// ===== Scene Selector (Visit Plan) =====
function initSceneSelector() {
  const sel = document.getElementById('sceneSelector');
  if (!sel) return;
  sel.addEventListener('click', (e) => {
    const btn = e.target.closest('.scene-btn');
    if (!btn) return;
    const scene = btn.dataset.scene;
    sel.querySelectorAll('.scene-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.scene-form').forEach(f => f.classList.remove('active'));
    document.getElementById('form-' + scene).classList.add('active');
  });
}

// ===== Render: Home =====
function renderHome() {
  const hotDiv = document.getElementById('hotSearch');
  (siteData.hotSearch || []).forEach(tag => {
    const a = document.createElement('a');
    a.href = '#';
    a.textContent = '#' + tag;
    a.onclick = (e) => { e.preventDefault(); document.getElementById('heroSearchInput').value = tag; handleSearch(); };
    hotDiv.appendChild(a);
  });
  const announcements = siteData.announcements || [];
  if (announcements.length > 0) {
    const textEl = document.getElementById('announceText');
    let idx = 0;
    function showAnnounce() {
      textEl.textContent = announcements[idx].text;
      idx = (idx + 1) % announcements.length;
    }
    showAnnounce();
    if (announcements.length > 1) setInterval(showAnnounce, 5000);
  }
  const grid = document.getElementById('quickGrid');
  (siteData.quickLinks || []).forEach(item => {
    const div = document.createElement('div');
    div.className = 'quick-card';
    div.innerHTML = \`
      <div class="card-icon">\${item.icon}</div>
      <div>
        <div class="card-title">\${item.title}</div>
        <div class="card-desc">\${item.desc}</div>
      </div>
    \`;
    div.onclick = () => {
      const btn = document.querySelector(\`.pill-btn[data-tab="\${item.tab}"]\`);
      if (btn) btn.click();
    };
    grid.appendChild(div);
  });
  const recGrid = document.getElementById('recommendGrid');
  const knowledge = (siteData.weapons && siteData.weapons.knowledge) || [];
  knowledge.slice(0, 4).forEach(item => {
    const isVideo = item.type === 'VIDEO';
    const div = document.createElement('div');
    div.className = 'rec-card';
    div.innerHTML = \`
      <div class="rec-thumb">\${isVideo ? 'ğŸ¬' : 'ğŸ“„'}</div>
      <div class="rec-info">
        <div class="rec-title">\${item.title}</div>
        <div class="rec-meta">
          <span class="rec-type \${isVideo ? 'type-video' : 'type-pdf'}">\${item.type}</span>
          \${isVideo ? item.duration : item.size} Â· \${item.date}
        </div>
        <a href="\${item.link}" class="btn-action" target="_blank">\${isVideo ? 'â–¶ è§‚çœ‹' : 'ğŸ“¥ æŸ¥çœ‹'}</a>
      </div>
    \`;
    recGrid.appendChild(div);
  });
}

// ===== Render: Weapons =====
function renderWeapons() {
  const weapons = siteData.weapons || {};
  const rulesList = document.getElementById('rulesList');
  (weapons.rules || []).forEach(item => {
    rulesList.innerHTML += \`
      <div class="doc-item">
        <div class="doc-icon">ğŸ“‹</div>
        <div class="doc-info">
          <div class="doc-name">\${item.title}</div>
          <div class="doc-meta">\${item.type} Â· \${item.size} Â· \${item.date}</div>
        </div>
        <a href="\${item.link}" class="btn-dl" target="_blank">æŸ¥çœ‹</a>
      </div>
    \`;
  });
  const toolGrid = document.getElementById('toolGrid');
  (weapons.tools || []).forEach(item => {
    toolGrid.innerHTML += \`
      <div class="tool-card" onclick="window.open('\${item.link}', '_blank')">
        <div class="tool-icon">\${item.icon}</div>
        <div class="tool-name">\${item.title}</div>
        <div class="tool-desc">\${item.desc}</div>
      </div>
    \`;
  });
  const knowledgeList = document.getElementById('knowledgeList');
  (weapons.knowledge || []).forEach(item => {
    const isVideo = item.type === 'VIDEO';
    knowledgeList.innerHTML += \`
      <div class="doc-item">
        <div class="doc-icon">\${isVideo ? 'ğŸ¬' : 'ğŸ“„'}</div>
        <div class="doc-info">
          <div class="doc-name">\${item.title}</div>
          <div class="doc-meta">\${item.type} Â· \${isVideo ? item.duration : item.size} Â· \${item.date}</div>
        </div>
        <a href="\${item.link}" class="btn-dl" target="_blank">\${isVideo ? 'è§‚çœ‹' : 'ä¸‹è½½'}</a>
      </div>
    \`;
  });
  const kbLink = document.getElementById('kbLink');
  if (weapons.knowledgeBaseLink) kbLink.href = weapons.knowledgeBaseLink;
}

// ===== Render: Guide =====
function renderGuide() {
  const guide = siteData.guide || {};
  const liveGrid = document.getElementById('liveGrid');
  (guide.liveTrainings || []).forEach(item => {
    liveGrid.innerHTML += \`
      <a href="\${item.link}" class="live-card" target="_blank">
        <div class="live-thumb">ğŸ“<span class="live-badge">ç›´æ’­</span></div>
        <div class="live-info">
          <div class="live-title">\${item.title}</div>
          <div class="live-meta">ğŸ• \${item.date} Â· è®²å¸ˆï¼š\${item.speaker}</div>
        </div>
      </a>
    \`;
  });
  const moreLiveLink = document.getElementById('moreLiveLink');
  if (guide.moreLiveLink && moreLiveLink) moreLiveLink.href = guide.moreLiveLink;
}

// ===== Render: Rank =====
function renderRank() {
  const rank = siteData.rank || {};
  function renderRankList(containerId, data, unit) {
    const el = document.getElementById(containerId);
    (data || []).forEach(item => {
      el.innerHTML += \`
        <div class="rank-item">
          <div class="rank-num">\${item.rank}</div>
          <div class="rank-name">\${item.name}</div>
          <div class="rank-score">\${typeof item.score === 'number' ? item.score.toLocaleString() + (unit || '') : item.score}</div>
        </div>
      \`;
    });
  }
  renderRankList('tokenRankList', rank.tokenRank, ' tokens');
  renderRankList('caseRankList', rank.caseRank, ' ä¸ªæ¡ˆä¾‹');
  renderRankList('studyRankList', rank.studyRank);
  renderRankList('certRankList', rank.certRank);
  const battleList = document.getElementById('battleList');
  (rank.battleReports || []).forEach(item => {
    battleList.innerHTML += \`
      <div class="battle-item">
        <div class="battle-icon">ğŸ…</div>
        <div class="battle-info">
          <div class="battle-title">\${item.title}</div>
          <div class="battle-meta">\${item.date}</div>
        </div>
        <div class="battle-amount">\${item.amount}</div>
      </div>
    \`;
  });
}

// ===== Render: Feedback =====
function renderFeedback() {
  const messages = (siteData.feedback && siteData.feedback.messages) || [];
  const msgList = document.getElementById('msgList');
  messages.forEach(item => {
    msgList.innerHTML += \`
      <div class="msg-item">
        <div class="msg-header">
          <span class="msg-author">\${item.author}</span>
          <span class="msg-date">\${item.date}</span>
        </div>
        <div class="msg-content">\${item.content}</div>
        <div class="msg-footer">
          <button class="btn-like" onclick="handleLike(this, \${item.likes})">â¤ï¸ \${item.likes}</button>
        </div>
      </div>
    \`;
  });
}

// ===== Action Handlers =====
function handleSearch() {
  const val = document.getElementById('heroSearchInput').value.trim();
  if (!val) { showToast('è¯·è¾“å…¥æœç´¢å†…å®¹'); return; }
  showToast('AIæœç´¢åŠŸèƒ½å°†åœ¨äºŒæœŸä¸Šçº¿ï¼Œæ•¬è¯·æœŸå¾…');
}

function handleCustomerAnalysis() {
  const val = document.getElementById('customerInput').value.trim();
  if (!val) { showToast('è¯·è¾“å…¥å®¢æˆ·åç§°'); return; }
  const outputDiv = document.getElementById('customerOutput');
  const contentDiv = document.getElementById('customerOutputContent');
  outputDiv.classList.add('show');
  contentDiv.innerHTML = '<span class="spinner"></span>AIæ­£åœ¨æ·±åº¦åˆ†æä¸­ï¼Œè¯·ç¨å€™ï¼ˆçº¦15-30ç§’ï¼‰...';
  callAI('customer_analysis', { customerName: val })
    .then(text => { contentDiv.textContent = text; })
    .catch(err => {
      contentDiv.textContent = 'âš  AIæ¥å£è°ƒç”¨å¤±è´¥ï¼š' + err.message + '\\n\\nä»¥ä¸‹ä¸ºç¦»çº¿æ¨¡æ¿æŠ¥å‘Šï¼š\\n\\n' + generateCustomerReport(val);
    });
}

function handleVisitPlan() {
  const activeScene = document.querySelector('.scene-btn.active');
  if (!activeScene) return;
  const scene = activeScene.dataset.scene;
  const form = document.getElementById('form-' + scene);
  const roleSelect = document.getElementById('visitRole');
  const inputs = form.querySelectorAll('input, select');
  let valid = true;
  if (!roleSelect.value.trim()) { valid = false; roleSelect.style.borderColor = '#f87171'; }
  else { roleSelect.style.borderColor = ''; }
  inputs.forEach(inp => {
    if (!inp.value.trim()) { valid = false; inp.style.borderColor = '#f87171'; }
    else { inp.style.borderColor = ''; }
  });
  if (!valid) { showToast('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹'); return; }
  const outputDiv = document.getElementById('visitOutput');
  const contentDiv = document.getElementById('visitOutputContent');
  outputDiv.classList.add('show');
  contentDiv.innerHTML = '<span class="spinner"></span>AIæ•™ç»ƒæ­£åœ¨ç”Ÿæˆæ‹œè®¿è®¡åˆ’ï¼Œè¯·ç¨å€™ï¼ˆçº¦15-30ç§’ï¼‰...';
  const details = Array.from(inputs).map(inp => {
    const label = inp.closest('.form-group')?.querySelector('label')?.textContent || '';
    return label.replace(' *', '') + 'ï¼š' + inp.value;
  }).join('\\n');
  callAI('visit_plan', { scene, role: roleSelect.value, details })
    .then(text => { contentDiv.textContent = text; })
    .catch(err => {
      contentDiv.textContent = 'âš  AIæ¥å£è°ƒç”¨å¤±è´¥ï¼š' + err.message + '\\n\\nä»¥ä¸‹ä¸ºç¦»çº¿æ¨¡æ¿è®¡åˆ’ï¼š\\n\\n' + generateVisitPlan(scene, form, roleSelect.value);
    });
}

function handleFeedback() {
  const content = document.getElementById('feedbackContent').value.trim();
  if (!content) { showToast('è¯·è¾“å…¥åé¦ˆå†…å®¹'); return; }
  const name = document.getElementById('feedbackName').value.trim() || 'åŒ¿åä¼™ä¼´';
  const company = document.getElementById('feedbackCompany').value.trim();
  const author = company ? name + ' Â· ' + company : name;
  const today = new Date().toISOString().split('T')[0];
  const msgList = document.getElementById('msgList');
  const newMsg = document.createElement('div');
  newMsg.className = 'msg-item';
  newMsg.innerHTML = \`
    <div class="msg-header">
      <span class="msg-author">\${author}</span>
      <span class="msg-date">\${today}</span>
    </div>
    <div class="msg-content">\${escapeHtml(content)}</div>
    <div class="msg-footer">
      <button class="btn-like" onclick="handleLike(this, 0)">â¤ï¸ 0</button>
    </div>
  \`;
  msgList.insertBefore(newMsg, msgList.firstChild);
  document.getElementById('feedbackContent').value = '';
  document.getElementById('feedbackName').value = '';
  document.getElementById('feedbackCompany').value = '';
  showToast('æ„Ÿè°¢åé¦ˆï¼å·²é€šçŸ¥ç®¡ç†å‘˜');
  sendFeedbackToAdmin(author, content);
}

function handleLike(btn, currentLikes) {
  if (btn.dataset.liked) return;
  btn.dataset.liked = '1';
  btn.textContent = 'â¤ï¸ ' + (currentLikes + 1);
  btn.style.background = 'rgba(239,68,68,0.2)';
}

// ===== AI API Call =====
async function callAI(type, input) {
  const resp = await fetch('/.netlify/functions/ai-proxy', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ type, input })
  });
  const data = await resp.json();
  if (!resp.ok || data.error) throw new Error(data.error || 'è¯·æ±‚å¤±è´¥');
  return data.content;
}

// ===== Helpers =====
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2500);
}

function escapeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

function sendFeedbackToAdmin(author, content) {
  console.log('[Feedback]', author, content);
}

// ===== Offline AI Templates (fallback) =====
function generateCustomerReport(name) {
  return 'ğŸ“Š ' + name + ' â€” AIæ½œåŠ›è¯„ä¼°æŠ¥å‘Šï¼ˆç¦»çº¿æ¨¡æ¿ï¼‰\\n\\n' +
    'ä¸€ã€å®¢æˆ·ä¸šåŠ¡æ¦‚å†µ\\n  â€¢ å•†ä¸šæ¨¡å¼ï¼šå¾…è¡¥å……\\n  â€¢ æ ¸å¿ƒå®¢æˆ·ç¾¤ä½“ï¼šå¾…è°ƒç ”\\n\\n' +
    'äºŒã€å…³é”®è¡Œä¸šè¶‹åŠ¿\\n  1. AIå¤§æ¨¡å‹è§„æ¨¡åŒ–è½åœ°\\n  2. äº‘åŸç”Ÿæ¶æ„æ¼”è¿›\\n\\n' +
    'ä¸‰ã€æœºä¼šä¸æŒ‘æˆ˜\\n  æœºä¼šï¼šAIèµ‹èƒ½ä¸šåŠ¡æµç¨‹\\n  æŒ‘æˆ˜ï¼šæ•°å­—åŒ–äººæ‰å‚¨å¤‡\\n\\n' +
    'âš  éƒ¨ç½²åˆ° Netlify å¹¶é…ç½® API Key åå³å¯ä½¿ç”¨ AI å®æ—¶ç”ŸæˆæŠ¥å‘Šã€‚';
}

function generateVisitPlan(scene, form, role) {
  const sceneLabels = { first: 'é¦–æ¬¡æ‹œè®¿', progress: 'å•†æœºæ¨è¿›', executive: 'é«˜å±‚æ‹œè®¿' };
  return 'ğŸ¯ ' + (sceneLabels[scene] || 'å®¢æˆ·æ‹œè®¿') + 'è®¡åˆ’ï¼ˆç¦»çº¿æ¨¡æ¿ï¼‰\\n\\n' +
    'ä¸€ã€æ‹œè®¿ç›®æ ‡ï¼šè®¤çŸ¥å¡‘é€ ä¸æ•™è‚²\\n\\n' +
    'äºŒã€ç”¨æˆ·è¡ŒåŠ¨æ‰¿è¯º\\n  æœ€é«˜ï¼šå®‰æ’POCæµ‹è¯•\\n  æœ€ä½ï¼šå®‰æ’äºŒæ¬¡ä¼šè®®\\n\\n' +
    'ä¸‰ã€ä¿¡æ¯è·å–\\n  1. å†³ç­–é“¾è·¯\\n  2. é¢„ç®—çŠ¶å†µ\\n\\n' +
    'âš  éƒ¨ç½²åˆ° Netlify å¹¶é…ç½® API Key åå³å¯ä½¿ç”¨ AI å®æ—¶ç”Ÿæˆæ‹œè®¿è®¡åˆ’ã€‚';
}`;

// ===== Save & Download =====
function saveAndDownload() {
  const data = collectData();
  const content = generateAppJS(data);
  const blob = new Blob([content], { type: 'application/javascript;charset=utf-8' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'app.js';
  a.click();
  URL.revokeObjectURL(a.href);
  showAdminToast('app.js å·²ä¸‹è½½ï¼è¯·æ›¿æ¢ js/app.js æ–‡ä»¶åé‡æ–°éƒ¨ç½²');
}

function previewLocal() {
  const data = collectData();
  const content = generateAppJS(data);
  const blob = new Blob([content], { type: 'application/javascript;charset=utf-8' });
  // Write to js/app.js via download prompt
  showAdminToast('è¯·å…ˆä¿å­˜ä¸‹è½½ app.jsï¼Œæ›¿æ¢ååˆ·æ–° index.html é¢„è§ˆ');
}

function showAdminToast(msg) {
  const t = document.getElementById('adminToast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ===== Init =====
loadCurrentData();
</script>

</body>
</html>
